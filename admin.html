<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  
  <!-- Primary Meta Tags -->
  <title>ููุญุฉ ุชุญูู ุงููุฏูุฑ | ุฌูุนูุฉ ุนุงุฆููุฉ</title>
  <meta name="description" content="ููุญุฉ ุฅุฏุงุฑุฉ ูุชุญูู ุงููุฏูุฑ ูุฌูุนูุฉ ุนุงุฆููุฉ">
  <meta name="keywords" content="ุฅุฏุงุฑุฉ, ุฌูุนูุฉ, ูุฏูุฑ, ูุดุชุฑููู, ุชุญุตูู">
  <meta name="author" content="ุฌูุนูุฉ ุนุงุฆููุฉ">
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  
  <!-- CSS -->
  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="css/theme_admin.css">
  <link rel="stylesheet" href="css/components/admin.css">
  <link rel="stylesheet" href="css/components/card.css">
  <link rel="stylesheet" href="css/components/table.css">
  <link rel="stylesheet" href="css/components/button.css">
  <link rel="stylesheet" href="css/components/form.css">
  <link rel="stylesheet" href="css/components/nav.css">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <!-- Preload Critical JS -->
  <link rel="preload" href="js/admin.bundle.js" as="script">
</head>

<body class="theme-admin admin-dashboard">
  
  <!-- Accessibility Skip Link -->
  <a href="#main-content" class="skip-link">ุชุฎุทู ุฅูู ุงููุญุชูู ุงูุฑุฆูุณู</a>
  
  <!-- Admin Header -->
  <header class="admin-header" role="banner">
    <div class="container">
      <div class="header-content">
        
        <!-- Logo and Home -->
        <div class="header-brand">
          <a href="index.html" class="brand-link" aria-label="ุงูุนูุฏุฉ ููุตูุญุฉ ุงูุฑุฆูุณูุฉ">
            <span class="brand-icon" aria-hidden="true">๐</span>
            <span class="brand-text">ุฌูุนูุฉ ุนุงุฆููุฉ</span>
          </a>
          <span class="header-divider" aria-hidden="true">/</span>
          <span class="header-title">ููุญุฉ ุงููุฏูุฑ</span>
        </div>
        
        <!-- User Info and Actions -->
        <div class="header-actions">
          <div class="user-profile" id="admin-profile">
            <span class="user-avatar" aria-hidden="true">๐</span>
            <span class="user-name" id="admin-name">ุงููุฏูุฑ</span>
          </div>
          
          <div class="action-buttons">
            <button id="btnLogout" class="btn btn--ghost btn--icon" type="button" aria-label="ุชุณุฌูู ุงูุฎุฑูุฌ">
              <span class="btn-icon" aria-hidden="true">๐ช</span>
              <span class="btn-text">ุฎุฑูุฌ</span>
            </button>
            
            <button id="btnRefreshAll" class="btn btn--ghost btn--icon" type="button" aria-label="ุชุญุฏูุซ ุฌููุน ุงูุจูุงูุงุช">
              <span class="btn-icon" aria-hidden="true">๐</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>
  
  <!-- Main Navigation Tabs -->
  <nav class="admin-tabs" role="navigation" aria-label="ุงูููุงุฆู ุงูุฑุฆูุณูุฉ">
    <div class="container">
      <ul class="tabs-list" role="tablist">
        <li class="tab-item" role="presentation">
          <button class="tab-button active" id="tab-home" role="tab" aria-selected="true" 
                  aria-controls="viewHome" data-view="home">
            <span class="tab-icon" aria-hidden="true">๐</span>
            <span class="tab-text">ููุญุฉ ุงูุชุญูู</span>
          </button>
        </li>
        <li class="tab-item" role="presentation">
          <button class="tab-button" id="tab-subscribers" role="tab" aria-selected="false"
                  aria-controls="viewSubscribers" data-view="subscribers">
            <span class="tab-icon" aria-hidden="true">๐ฅ</span>
            <span class="tab-text">ุงููุดุชุฑููู</span>
          </button>
        </li>
        <li class="tab-item" role="presentation">
          <button class="tab-button" id="tab-associations" role="tab" aria-selected="false"
                  aria-controls="viewAssociations" data-view="associations">
            <span class="tab-icon" aria-hidden="true">๐ข</span>
            <span class="tab-text">ุงูุฌูุนูุงุช</span>
          </button>
        </li>
        <li class="tab-item" role="presentation">
          <button class="tab-button" id="tab-devices" role="tab" aria-selected="false"
                  aria-controls="viewDevices" data-view="devices">
            <span class="tab-icon" aria-hidden="true">๐ฑ</span>
            <span class="tab-text">ุงูุฃุฌูุฒุฉ</span>
          </button>
        </li>
      </ul>
    </div>
  </nav>
  
  <!-- Main Content Area -->
  <main id="main-content" class="container" role="main">
    
    <!-- Dashboard View (Home) -->
    <section id="viewHome" class="admin-view active" role="tabpanel" aria-labelledby="tab-home">
      <div class="view-header">
        <h1 class="view-title">ููุญุฉ ุชุญูู ุงููุฏูุฑ</h1>
        <p class="view-subtitle">ุฅุฏุงุฑุฉ ุฌููุน ุฌูุงูุจ ูุธุงู ุฌูุนูุฉ ุนุงุฆููุฉ</p>
      </div>
      
      <div class="dashboard-grid">
        
        <!-- Subscribers Card -->
        <article class="dashboard-card" role="button" tabindex="0" data-view="subscribers">
          <div class="card-icon" aria-hidden="true">๐ฅ</div>
          <h3 class="card-title">ุฅุฏุงุฑุฉ ุงููุดุชุฑููู</h3>
          <p class="card-description">
            ุนุฑุถ ูุชุนุฏูู ุจูุงูุงุช ุงููุดุชุฑูููุ ุฅุฏุงุฑุฉ ุงูุฌูุงูุงุชุ ุงูุฑููุฒุ ูุฑูู PIN
          </p>
          <div class="card-stats">
            <span class="stat-label">ุนุฏุฏ ุงููุดุชุฑููู:</span>
            <span class="stat-value" id="subscriber-count">ุฌุงุฑู ุงูุชุญููู...</span>
          </div>
          <div class="card-action">
            <span class="action-text">ูุชุญ ุงูุฅุฏุงุฑุฉ</span>
            <span class="action-icon" aria-hidden="true">โ</span>
          </div>
        </article>
        
        <!-- Associations Card -->
        <article class="dashboard-card" role="button" tabindex="0" data-view="associations">
          <div class="card-icon" aria-hidden="true">๐ข</div>
          <h3 class="card-title">ุฅุฏุงุฑุฉ ุงูุฌูุนูุงุช</h3>
          <p class="card-description">
            ุฅูุดุงุก ุฌูุนูุงุช ุฌุฏูุฏุฉุ ุนุฑุถ ุฌููุน ุงูุฌูุนูุงุชุ ุฅุฏุงุฑุฉ ุชูุงุตูู ูู ุฌูุนูุฉ
          </p>
          <div class="card-stats">
            <span class="stat-label">ุนุฏุฏ ุงูุฌูุนูุงุช:</span>
            <span class="stat-value" id="association-count">ุฌุงุฑู ุงูุชุญููู...</span>
          </div>
          <div class="card-action">
            <span class="action-text">ูุชุญ ุงูุฅุฏุงุฑุฉ</span>
            <span class="action-icon" aria-hidden="true">โ</span>
          </div>
        </article>
        
        <!-- Devices Card -->
        <article class="dashboard-card" role="button" tabindex="0" data-view="devices">
          <div class="card-icon" aria-hidden="true">๐ฑ</div>
          <h3 class="card-title">ุงุนุชูุงุฏ ุงูุฃุฌูุฒุฉ</h3>
          <p class="card-description">
            ุฅุฏุงุฑุฉ ุทูุจุงุช ุฃุฌูุฒุฉ ุงููุดุชุฑูููุ ุงูููุงููุฉ ุฃู ุงูุฑูุถ ููุฃุฌูุฒุฉ ุงูุฌุฏูุฏุฉ
          </p>
          <div class="card-stats">
            <span class="stat-label">ุทูุจุงุช ููุฏ ุงูุงูุชุธุงุฑ:</span>
            <span class="stat-value" id="pending-devices">ุฌุงุฑู ุงูุชุญููู...</span>
          </div>
          <div class="card-action">
            <span class="action-text">ูุชุญ ุงูุฅุฏุงุฑุฉ</span>
            <span class="action-icon" aria-hidden="true">โ</span>
          </div>
        </article>
        
        <!-- Reports Card -->
        <article class="dashboard-card" role="button" tabindex="0" data-view="reports">
          <div class="card-icon" aria-hidden="true">๐</div>
          <h3 class="card-title">ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช</h3>
          <p class="card-description">
            ุชูุงุฑูุฑ ูุงููุฉุ ุฅุญุตุงุฆูุงุช ุงูุงุณุชุฎุฏุงูุ ุชูุงุฑูุฑ ุดูุฑู ูุณููู
          </p>
          <div class="card-stats">
            <span class="stat-label">ุขุฎุฑ ุชุญุฏูุซ:</span>
            <span class="stat-value">ุงูููู</span>
          </div>
          <div class="card-action">
            <span class="action-text">ุนุฑุถ ุงูุชูุงุฑูุฑ</span>
            <span class="action-icon" aria-hidden="true">โ</span>
          </div>
        </article>
        
        <!-- Settings Card -->
        <article class="dashboard-card" role="button" tabindex="0" data-view="settings">
          <div class="card-icon" aria-hidden="true">โ๏ธ</div>
          <h3 class="card-title">ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ</h3>
          <p class="card-description">
            ุฅุนุฏุงุฏุงุช ุงููุธุงูุ ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุชุ ุฅุนุฏุงุฏุงุช ุงูุงุชุตุงู ูุงูุฅุดุนุงุฑุงุช
          </p>
          <div class="card-stats">
            <span class="stat-label">ุงููุธุงู:</span>
            <span class="stat-value">ูุนูู ุจููุงุกุฉ</span>
          </div>
          <div class="card-action">
            <span class="action-text">ูุชุญ ุงูุฅุนุฏุงุฏุงุช</span>
            <span class="action-icon" aria-hidden="true">โ</span>
          </div>
        </article>
        
        <!-- Quick Actions -->
        <article class="dashboard-card card-quick-actions">
          <h3 class="card-title">ุฅุฌุฑุงุกุงุช ุณุฑูุนุฉ</h3>
          <div class="quick-actions">
            <button class="quick-action" data-action="create-user">
              <span class="action-icon" aria-hidden="true">โ</span>
              <span class="action-text">ูุดุชุฑู ุฌุฏูุฏ</span>
            </button>
            <button class="quick-action" data-action="backup">
              <span class="action-icon" aria-hidden="true">๐พ</span>
              <span class="action-text">ูุณุฎุฉ ุงุญุชูุงุทูุฉ</span>
            </button>
            <button class="quick-action" data-action="notify">
              <span class="action-icon" aria-hidden="true">๐ข</span>
              <span class="action-text">ุฅุฑุณุงู ุฅุดุนุงุฑ</span>
            </button>
            <button class="quick-action" data-action="export">
              <span class="action-icon" aria-hidden="true">๐ค</span>
              <span class="action-text">ุชุตุฏูุฑ ุจูุงูุงุช</span>
            </button>
          </div>
        </article>
      </div>
      
      <!-- Dashboard Stats -->
      <div class="dashboard-stats">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon" aria-hidden="true">๐ฐ</div>
            <div class="stat-content">
              <div class="stat-value" id="total-collected">0 ุฑ.ุณ</div>
              <div class="stat-label">ุฅุฌูุงูู ุงููุชุญุตู</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" aria-hidden="true">๐</div>
            <div class="stat-content">
              <div class="stat-value" id="active-months">0</div>
              <div class="stat-label">ุดูุฑ ูุดุท</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" aria-hidden="true">โ</div>
            <div class="stat-content">
              <div class="stat-value" id="completed-prefs">0</div>
              <div class="stat-label">ุฑุบุจุงุช ููุชููุฉ</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" aria-hidden="true">โ๏ธ</div>
            <div class="stat-content">
              <div class="stat-value" id="pending-actions">0</div>
              <div class="stat-label">ุฅุฌุฑุงุกุงุช ูุนููุฉ</div>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Subscribers View -->
    <section id="viewSubscribers" class="admin-view" role="tabpanel" aria-labelledby="tab-subscribers" hidden>
      <!-- Content will be loaded dynamically -->
      <div class="view-loading">
        <div class="loading-spinner" aria-hidden="true"></div>
        <p>ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุงููุดุชุฑููู...</p>
      </div>
    </section>
    
    <!-- Associations View -->
    <section id="viewAssociations" class="admin-view" role="tabpanel" aria-labelledby="tab-associations" hidden>
      <!-- Content will be loaded dynamically -->
      <div class="view-loading">
        <div class="loading-spinner" aria-hidden="true"></div>
        <p>ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุงูุฌูุนูุงุช...</p>
      </div>
    </section>
    
    <!-- Devices View -->
    <section id="viewDevices" class="admin-view" role="tabpanel" aria-labelledby="tab-devices" hidden>
      <!-- Content will be loaded dynamically -->
      <div class="view-loading">
        <div class="loading-spinner" aria-hidden="true"></div>
        <p>ุฌุงุฑู ุชุญููู ุทูุจุงุช ุงูุฃุฌูุฒุฉ...</p>
      </div>
    </section>
    
    <!-- Collection View -->
    <section id="viewCollection" class="admin-view" role="tabpanel" hidden>
      <!-- Dynamic content -->
    </section>
    
    <!-- Association Detail View -->
    <section id="viewAssocDetail" class="admin-view" role="tabpanel" hidden>
      <!-- Dynamic content -->
    </section>
    
  </main>
  
  <!-- Toast Notifications -->
  <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true">
    <!-- Toast messages will be inserted here -->
  </div>
  
  <!-- Logout Confirmation Modal -->
  <div id="logout-modal" class="modal" hidden role="dialog" aria-labelledby="logout-title" aria-modal="true">
    <div class="modal-content">
      <h3 id="logout-title" class="modal-title">ุชุฃููุฏ ุชุณุฌูู ุงูุฎุฑูุฌ</h3>
      <p class="modal-message">ูู ุฃูุช ูุชุฃูุฏ ูู ุชุณุฌูู ุงูุฎุฑูุฌ ูู ููุญุฉ ุงูุฅุฏุงุฑุฉุ</p>
      <div class="modal-actions">
        <button id="logout-cancel" class="btn btn--secondary" type="button">ุฅูุบุงุก</button>
        <button id="logout-confirm" class="btn btn--danger" type="button">ูุนูุ ุณุฌู ุฎุฑูุฌ</button>
      </div>
    </div>
  </div>
  
  <!-- Global Loading Overlay -->
  <div id="global-loading" class="loading-overlay" hidden>
    <div class="loading-content">
      <div class="loading-spinner large"></div>
      <p class="loading-text">ุฌุงุฑู ุงููุนุงูุฌุฉ...</p>
    </div>
  </div>
  
  <!-- JavaScript -->
  <script>
    // Admin Configuration
    window.AdminConfig = {
      apiBaseUrl: '/api/admin',
      refreshInterval: 300000, // 5 minutes
      autoSave: true,
      features: {
        export: true,
        bulkActions: true,
        realTimeUpdates: false
      },
      permissions: {
        canDelete: true,
        canCreateAssoc: true,
        canManageDevices: true
      }
    };
    
    // Set current user info
    document.addEventListener('DOMContentLoaded', function() {
      // Set admin name if available
      const adminName = localStorage.getItem('admin_name') || 'ุงููุฏูุฑ';
      document.getElementById('admin-name').textContent = adminName;
      
      // Initialize current date
      const today = new Date().toLocaleDateString('ar-SA', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
      
      // Add today's date to dashboard
      const dashboardTitle = document.querySelector('.view-subtitle');
      if (dashboardTitle) {
        dashboardTitle.textContent = `ุฅุฏุงุฑุฉ ุฌููุน ุฌูุงูุจ ูุธุงู ุฌูุนูุฉ ุนุงุฆููุฉ - ${today}`;
      }
    });
  </script>
  
  <!-- Bundle all admin JS files -->
  <script src="js/admin.bundle.js"></script>
  
  <!-- Initialize Admin Dashboard -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize tab functionality
      const tabButtons = document.querySelectorAll('.tab-button');
      tabButtons.forEach(button => {
        button.addEventListener('click', function() {
          const viewId = this.getAttribute('data-view');
          switchView(viewId);
        });
      });
      
      // Dashboard card clicks
      const dashboardCards = document.querySelectorAll('.dashboard-card[data-view]');
      dashboardCards.forEach(card => {
        card.addEventListener('click', function() {
          const viewId = this.getAttribute('data-view');
          switchView(viewId);
        });
        
        // Keyboard support
        card.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            const viewId = this.getAttribute('data-view');
            switchView(viewId);
          }
        });
      });
      
      // Logout confirmation
      const logoutBtn = document.getElementById('btnLogout');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function() {
          const modal = document.getElementById('logout-modal');
          modal.hidden = false;
          document.body.style.overflow = 'hidden';
        });
      }
      
      // Modal close handlers
      document.getElementById('logout-cancel').addEventListener('click', function() {
        document.getElementById('logout-modal').hidden = true;
        document.body.style.overflow = '';
      });
      
      document.getElementById('logout-confirm').addEventListener('click', function() {
        // Perform logout
        window.location.href = 'admin_login.html';
      });
      
      // Global view switching function
      window.switchView = function(viewId) {
        // Update tabs
        tabButtons.forEach(btn => {
          const isActive = btn.getAttribute('data-view') === viewId;
          btn.setAttribute('aria-selected', isActive);
          btn.classList.toggle('active', isActive);
        });
        
        // Show selected view
        document.querySelectorAll('.admin-view').forEach(view => {
          const isTarget = view.id === `view${viewId.charAt(0).toUpperCase() + viewId.slice(1)}`;
          view.hidden = !isTarget;
          
          if (isTarget) {
            view.setAttribute('aria-hidden', 'false');
            // Load view data if needed
            loadViewData(viewId);
          } else {
            view.setAttribute('aria-hidden', 'true');
          }
        });
        
        // Update browser history
        history.pushState({ view: viewId }, '', `#${viewId}`);
      };
      
      // Load data for a specific view
      function loadViewData(viewId) {
        // This would be implemented in admin.js
        console.log(`Loading data for view: ${viewId}`);
      }
      
      // Handle browser back/forward
      window.addEventListener('popstate', function(event) {
        if (event.state && event.state.view) {
          switchView(event.state.view);
        }
      });
      
      // Initialize with home view
      const initialView = window.location.hash.replace('#', '') || 'home';
      switchView(initialView);
    });
  </script>
</body>
</html>